# Watch for You Server

這個程式屬於Watch for You方案中的「網頁伺服器」。

這個專案還有其他的部分，各部分功能請參考下面的「專案架構」：

 - [手錶程式](https://github.com/Nyanpass-Tsundere/WatchForYouUploader)
 - [門禁讀卡機程式](https://github.com/Nyanpass-Tsundere/WatchForYouDoor)

本程式使用到的框架如下：

 - Semantic UI
 - jQuery 2.2 (使用1.9也行，但是為了相容IE6燒CPU不划算)
 - Python3 或 pypy3
	 - [flask](http://flask.pocoo.org/)、[sympy](http://www.sympy.org)、[pyqrcode](http://pythonhosted.org/PyQRCode/)


## 專案架構

- 伺服器
	- 接收手錶上傳的Beacons資料分析，並計算座標
	- 紀錄手錶軌跡
	- 提供路線計算功能
	- 提供網頁管理介面

- 手錶
	- 提供訪客導航
	- 上傳Beacons資料

- Beacons
	- 須將Beacons座標、MacAddress寫入`setting.py`
	- 定時發送訊號

- 門禁讀卡機
	- 向Server查詢該不該開門

## 動機

### 目前門禁系統無法得知目前訪客位置
目前的門禁系統都只能「禁止訪客」去開某些門，但是如果公司內有人與訪客認識帶訪客參觀不該參觀的地方、或是員工開門後被「跟車進入」，管理室與公司無從得知，可能造成管理風險。

因此我們希望建立一個系統可以更精確的追蹤訪客所在位置。

### 商辦大樓結構複雜
我們組員曾經前往某個商辦大樓完成職業訪查的作業時，在大樓裡面迷路了。

然而在商辦大樓內，GPS導航是有困難的，所以我們希望可以用藍芽Beacons進行定位並提供導航功能。

## 特色
本作品獲得「[育秀杯創意獎  軟體應用類 佳作](http://award.ysed.org.tw/news/detail/n/20)」肯定，感謝評審委員肯定！可以參考比賽用的[YouTube影片](https://www.youtube.com/watch?v=hup7yl3W0k8)。

### 提供訪客智慧手錶
透過智慧手錶提供訪客身分認證，並提供導航資訊。使用手錶的原因莫過於智慧手錶可以提供較大的畫面顯示門禁QR-Code與導航資訊，目前系統設計在導航過程中會顯示方向－－該往哪裡走；導航結束後則顯示門禁QR-Code讓訪客開門。

同時智慧手錶上顯示的門禁QR-Code是有期限的，當期限結束後就直接作廢，不用擔心傳統門禁系統「預先設定門禁卡」後，門禁卡遭竊可能遇到的風險。

### Beacon定位
透過Beacon發射藍芽可探索訊號，讓手錶可以抓到藍芽裝置並且提供RSSI訊號強度資訊給伺服器計算。

透過Beacon定位可以讓管理室了解訪客所在位置，並且讓訪客進入管制區時可以有警報。

### 導航
透過Beacon完成定位後，透過伺服器上的地圖計算導航路線，並將前進方向顯示在在手錶上。

### 網頁管理介面
提供「訪客監控」、「區域設定」、「手錶設定」。

訪客監控介面就相當簡單，只是提供網頁介面可以在地圖上看到訪客目前的位置（紅色圓點），目前提供一次監控一隻手錶。

若訪客進入管制區，無論目前是否監控該手錶，都會直接用Semantic UI跳出Modal做警告。

區域設定則是提供設定導航目的地、管制區等地區的設定。

手錶設定則是可以修改手錶的名稱，手錶名稱會在手錶向伺服器註冊時，隨機產生名稱(手錶00~手錶99)，可以在這邊修改。

修改名稱外，啟用手錶的動作也是在這邊。手錶未啟用就只是一隻手錶掛在那邊；手錶啟用後才會開始提供導航、門禁QR-Code顯示等功能。

### 門禁讀卡機
採用Web介面撰寫，連接WebCAM讀取QR-Code。
